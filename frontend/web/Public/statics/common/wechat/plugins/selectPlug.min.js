(function(g){var v=g("#swiperWrap"),x=g("#headerSearch"),q=g("#letterShow"),d=g("#letterWrap"),n=g("#letterWrapMask"),o=g("#clearBtn"),j=g("#searchText"),m=g("#searchBtn"),c=g("#departmentList"),w=g("#normalList"),b=g("#selectSureBtn"),f=g("#allList"),l=g("#selectWrap"),s=g("#searchList"),r=g("#parentsList"),u=g("#selectContainer"),p=g("#swiperFixed"),t=g("#ajaxLoading"),i=g("#selectGoTop"),k=null,a=null,h=stafflistDroploadObj=allUserDroploadObj=null,e=0;
window.YiSelect={init:function(y){a=y;this.bindEvent();},lazyload:function(){l.find("img").lazyload();},searchAll:function(y){var z=this;g.ajax({url:"/address/staff/search",type:"get",data:{aid:_aid,action:"paging",search:y,appstore_id:window.__appstoreid,page:0},beforeSend:function(){t.show();
},dataType:"json",success:function(B){t.hide();if(B.stafflist){var A="";g.each(B.stafflist,function(C,F){var E="",D="<dt>"+C.toUpperCase()+"</dt>";g.each(F,function(G,H){E+='<dd data-uid="'+H.id+'"><em></em><img data-src="'+((H.we_avatar!="")?H.we_avatar:defaultAvatar)+'" src="'+defaultAvatar+'" />'+H.we_name+"</dd>";
});A+="<dl>"+D+E+"</dl>";});if(A){s.children("span").remove();}s.html(A);z.userSelect();z.lazyload();}else{s.html("<span>暂无数据...</span>");}}});},searchRender:function(){var y=this;
m.unbind("click").on("click",function(){g.each(x.find("li"),function(z,A){if(g(A).hasClass("cur")){g(A).removeClass("cur").addClass("on");}});s.html("").show().siblings("section").hide();
if(e==1||e==2||e==3){y.searchAll(g.trim(j.val()));if(e==3){b.show();}}});},normalUserPage:2,normalUserDropload:false,normalUserScroll:function(){var y=this;
h=w.dropload({scrollArea:window,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},loadDownFn:function(z){y.renderNormalUser("",y.normalUserPage,w);
y.normalUserPage++;z.resetload();}});y.normalUserDropload=true;},allUserPage:2,allUserDropload:false,allUserScroll:function(){var y=this;window.allUserDroploadObj=f.dropload({scrollArea:window,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},loadDownFn:function(z){y.renderAllUser(y.allUserPage);
y.allUserPage++;z.resetload();}});y.allUserDropload=true;},renderSwiper:function(){k=new Swiper(".swiper-container",{slidesPerView:"auto",centeredSlides:false,slidesPerView:"auto",speed:1000,spaceBetween:5});
},renderData:function(){var y=[];g.each(v.find("div.swiper-slide"),function(z,A){var B={};B.name=g(A).data("name");B.src=g.trim(g(A).children("img").attr("src"));
B.uid=g(A).data("uid");y.push(B);});return y;},renderNormalUser:function(z,y,A){var B=this;g.ajax({url:"/address/staff/contactlist",type:"get",data:{aid:_aid,action:"paging",search:z,page:y},dataType:"json",beforeSend:function(){t.show();
},success:function(D){t.hide();if(D.stafflist){var C="";g.each(D.stafflist,function(E,H){var G="",F="<dt>"+E.toUpperCase()+"</dt>";g.each(H,function(I,J){G+='<dd data-uid="'+J.id+'"><em></em><img data-src="'+((J.we_avatar!="")?J.we_avatar:defaultAvatar)+'" src="'+defaultAvatar+'" />'+J.we_name+"</dd>";
});C+="<dl>"+F+G+"</dl>";});if(C){A.children("span").remove();}A.append(C);B.userSelect();B.lazyload();if(h){h.lock();}}}});},renderAllUser:function(y){var z=this;
g.ajax({url:"/address/staff/list",type:"get",data:{aid:_aid,action:"paging",appstore_id:window.__appstoreid,page:y},beforeSend:function(){t.show();},dataType:"json",success:function(B){t.hide();
if(B.stafflist){var A="";g.each(B.stafflist,function(C,F){var E="",D="<dt>"+C.toUpperCase()+"</dt>";g.each(F,function(G,H){E+='<dd data-uid="'+H.id+'"><em></em><img data-src="'+((H.we_avatar!="")?H.we_avatar:defaultAvatar)+'" src="'+defaultAvatar+'" />'+H.we_name+"</dd>";
});A+="<dl>"+D+E+"</dl>";});if(A){f.children("span").remove();}f.append(A);z.userSelect();z.lazyload();if(allUserDroploadObj){allUserDroploadObj.lock();
}}}});},renderDepartment:function(){var y=this;g.ajax({url:"/address/staff/deptlist",type:"get",data:{aid:_aid,appstore_id:window.__appstoreid,action:"paging"},beforeSend:function(){t.show();
},dataType:"json",success:function(A){t.hide();c.html("");if(A.deptlist&&A.countlist){function z(B,C){if((B._child&&B._child.length>0)){C.append("<ul></ul>");
C=C.find("ul");g.each(B._child,function(D,E){(function(G){var H="",F="";g.each(A.countlist,function(I,J){if(E.id==I){F=J.count?J.count:"";H=J.department_id?J.department_id:"";
return false;}});C.append('<li><a href="javascript:void(0)" data-num="'+F+'" data-pid="'+H+'">'+E.we_name+"</a></li>");if(E._child&&E._child.length>0){z(E,g(C.children("li")[G]));
}})(D);});}}z(A.deptlist[0],c);y.departmentMethod();}}});},departmentMethod:function(){var y=this;g.each(c.find("li"),function(z,A){if(g(A).children("ul").length){g(A).children("a").append("<em></em>");
}if(g(A).children("a")&&g(A).children("a").data("num")){g(A).children("a").append('<i data-num="'+g(A).children("a").data("num")+'">'+g(A).children("a").data("num")+"</i>");
g(A).children("a").append("<span></span>");}});c.find("li a").unbind("click").on("click",function(z){g(this).parent().children("ul").toggle();g(this).toggleClass("cur");
z.preventDefault();});c.find("li a > i").unbind("click").on("click",function(z){if(!g(this).data("num")){return false;}y.stafflistAjaxPage=2;y.staffParmentId=g.trim(g(this).parents("a").data("pid"));
y.stafflistAjax(_aid,y.staffParmentId,1);x.find("li").eq(2).removeClass("cur").addClass("on");b.show();r.html("").show();c.hide();z.stopPropagation();});
},stafflistAjaxPage:2,staffParmentId:null,stafflistDropload:false,stafflistAjaxScroll:function(){var y=this;window.stafflistDroploadObj=r.dropload({scrollArea:window,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},loadDownFn:function(z){y.stafflistAjax(_aid,y.staffParmentId,y.stafflistAjaxPage);
y.stafflistAjaxPage++;z.resetload();}});y.stafflistDropload=true;},stafflistAjax:function(A,y,z){var B=this;g.ajax({url:"/address/staff/stafflist",type:"get",beforeSend:function(){t.show();
},data:{aid:A,deptid:y,appstore_id:window.__appstoreid,action:"paging",page:z},dataType:"json",success:function(D){t.hide();if(D.stafflist){var C="";g.each(D.stafflist,function(E,H){var G="",F="<dt>"+E.toUpperCase()+"</dt>";
g.each(H,function(I,J){G+='<dd data-uid="'+J.id+'"><em></em><img data-src="'+((J.we_avatar!="")?J.we_avatar:defaultAvatar)+'" src="'+defaultAvatar+'" />'+J.we_name+"</dd>";
});C+="<dl>"+F+G+"</dl>";});if(C){r.append(C);}B.userSelect();B.lazyload();if(stafflistDroploadObj){stafflistDroploadObj.lock();}}}});},userSelect:function(){var y=this;
l.find("dd").unbind("click").on("click",function(){var A=this;if(a==0){g(this).parents("section").siblings("section").find("dd").removeClass("cur");g(this).siblings().removeClass("cur");
g(this).parents("dl").siblings().find("dd").removeClass("cur");g(this).toggleClass("cur");if(g(this).hasClass("cur")){v.find(".swiper-wrapper").html("").append('<div class="swiper-slide" data-uid="'+g.trim(g(this).data("uid"))+'" data-name="'+g(this).text()+'"><img src="'+g(this).children("img").attr("src")+'" />');
p.show();u.css({"padding-top":"65px"});}else{v.find(".swiper-wrapper").html("");p.hide();u.css({"padding-top":"0"});}}else{g(this).toggleClass("cur");var z=false;
if(g(this).hasClass("cur")){g.each(v.find(".swiper-wrapper > .swiper-slide"),function(C,D){if(g(D).data("uid")==g(A).data("uid")){z=true;}});if(!z){v.find(".swiper-wrapper").append('<div class="swiper-slide" data-uid="'+g.trim(g(this).data("uid"))+'" data-name="'+g(this).text()+'"><img src="'+g(this).children("img").attr("src")+'" />');
}p.show();u.css({"padding-top":"65px"});}else{var B=g(this).data("uid");g.each(v.find(".swiper-wrapper > .swiper-slide"),function(C,D){if(g(D).data("uid")==B){g(D).remove();
}if(!v.find(".swiper-wrapper > .swiper-slide").length){p.hide();u.css({"padding-top":"0"});}});}}y.swiperImgClick();k.onResize();});},getUrlParam:function(y){y=y||window.location.href;
var B=new Object();if(y.indexOf("?")!=-1){y=y.split("?")[1];var A=y.split("&");for(var z=0;z<A.length;z++){B[A[z].split("=")[0]]=decodeURI((A[z].split("=")[1]));
}}return B;},tab:function(){var y=this;x.find("ul > li").unbind("click").on("click",function(){s.hide();if(g(this).hasClass("cur")){return false;}var z=g(this).index();
g(this).addClass("cur").siblings().removeClass("cur").removeClass("on");if(z==0){w.show();f.hide();c.hide();b.show();r.hide();if(!g(this).data("visited")){y.renderNormalUser("",1,w);
g(this).data("visited",1);}e=1;}else{if(z==1){f.show();w.hide();c.hide();b.show();r.hide();if(!g(this).data("visited")){y.renderAllUser(1);g(this).data("visited",1);
}e=2;}else{f.hide();w.hide();c.html("").show();b.hide();y.renderDepartment();e=3;r.hide();}}}).eq(0).trigger("click");},swiperImgClick:function(){var y=this;
this.renderSwiper();v.find(".swiper-wrapper img").unbind("click").on("click",function(){g(this).parents(".swiper-slide").remove();if(!v.find(".swiper-wrapper > .swiper-slide").length){p.hide();
u.css({"padding-top":"0"});}if(a=="0"){l.find("dd").removeClass("cur");}else{var z=g(this).parents("div").data("uid");g.each(l.find("dd"),function(A,B){if(g(B).data("uid")==z){g(B).removeClass("cur");
}});}k.onResize();});},resetCloseLayer:function(){x.find("ul > li").removeClass("cur").removeClass("on");x.find("ul > li").data("visited",0);l.children("section").html("<span>暂无数据...</span>");
v.find(".swiper-wrapper").html("");p.hide();u.css({"padding-top":"0"});this.stafflistAjaxPage=this.normalUserPage=this.allUserPage=2;g(window).unbind("scroll");
h=allUserDroploadObj=stafflistDroploadObj=null;},bindEvent:function(){var y=this;b.find("li").eq(0).children("a").unbind("click").on("click",function(z){window.__appstoreid=0;
var A=g(top.document.body);A.find(".plug-select").removeClass("selected");A.find("#selectContainer").hide();i.hide();b.hide();y.resetCloseLayer();g(window).scrollTop(window._scrollTopVal);
if(window.selectPlugCancelCallback){window.selectPlugCancelCallback();}z.preventDefault();});b.find("li").eq(1).children("a").unbind("click").on("click",function(A){window.__appstoreid=0;
var z=y.renderData();if(!z.length){YI.alert({msg:"请选择联系人"});return false;}g(window).scrollTop(window._scrollTopVal);i.hide();var B=g(top.document.body);
b.hide();top.renderContactList(y.renderData());B.find("#selectContainer").hide();y.resetCloseLayer();if(window.selectPlugSureCallback){window.selectPlugSureCallback();
}A.preventDefault();});this.tab();q.on("click",function(){var z=g(this).offset().top;d.css({top:z+32});n.show();d.show();g.each(x.find("li"),function(A,B){if(g(B).hasClass("cur")){g(B).removeClass("cur").addClass("on");
}});});n.unbind("click").on("click",function(){n.hide();d.hide();});d.find("ul > li > a > em").unbind("click").on("click",function(){s.show().siblings("section").hide();
d.hide();n.hide();y.searchAll(g.trim(g(this).html()));});j.on("keyup",function(){if(g.trim(g(this).val())){o.show();q.hide();m.show();}else{o.hide();q.show();
m.hide();}});o.unbind("click").on("click",function(){j.val("");g(this).hide();m.hide();q.show();});this.windowScroll();this.searchRender();i.on("click",function(){scrollGoTop();
});},windowScroll:function(){var y=this;if(!y.normalUserDropload){y.normalUserScroll();}if(!y.allUserDropload){y.allUserScroll();}if(!y.stafflistDropload){y.stafflistAjaxScroll();
}g(window).unbind("scroll").bind("scroll",function(){var A=u.height(),B=g(window).height(),z=g(window).scrollTop();if(A-B-z<5){if(h){h.unlock();}if(allUserDroploadObj){allUserDroploadObj.unlock();
}if(stafflistDroploadObj){stafflistDroploadObj.unlock();}if(!y.normalUserDropload){y.normalUserScroll();}if(!y.allUserDropload){y.allUserScroll();}if(!y.stafflistDropload){y.stafflistAjaxScroll();
}}y.lazyload();if(z>148){i.css("display","block");}else{i.css("display","none");}});}};})(Zepto);window.scrollGoTop=function(f,e){f=f||0.1;e=e||16;var c=0;
var l=0;var b=0;var j=0;var a=0;var g=0;if(document.documentElement){c=document.documentElement.scrollLeft||0;l=document.documentElement.scrollTop||0;}if(document.body){b=document.body.scrollLeft||0;
j=document.body.scrollTop||0;}var a=window.scrollX||0;var g=window.scrollY||0;var k=Math.max(c,Math.max(b,a));var i=Math.max(l,Math.max(j,g));var d=1+f;
window.scrollTo(Math.floor(k/d),Math.floor(i/d));if(k>0||i>0){var h="scrollGoTop("+f+", "+e+")";window.setTimeout(h,e);}};