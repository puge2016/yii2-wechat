(function(o){"use strict";var e=o(window);var t=o(document);o.fn.dropload=function(o){return new s(this,o)};var s=function(e,t){var s=this;s.$element=o(e);s.insertDOM=false;s.loading=false;s.isLock=false;s.init(t)};s.prototype.init=function(t){var s=this;s.opts=o.extend({},{scrollArea:s.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多</div>',domUpdate:'<div class="dropload-update">↓释放加载</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},distance:50,loadUpFn:"",loadDownFn:""},t);if(s.opts.scrollArea==window){s.$scrollArea=e}else{s.$scrollArea=s.opts.scrollArea}s.$element.on("touchstart",function(o){if(!s.loading&&!s.isLock){d(o);i(o,s)}});s.$element.on("touchmove",function(o){if(!s.loading&&!s.isLock){d(o,s);n(o,s)}});s.$element.on("touchend",function(){if(!s.loading&&!s.isLock){a(s)}})};function d(o){if(!o.touches){o.touches=o.originalEvent.touches}}function i(o,s){s._startY=o.touches[0].pageY;if(s.opts.scrollArea==window){s._meHeight=e.height();s._childrenHeight=t.height()}else{s._meHeight=s.$element.height();s._childrenHeight=s.$element.children().height()}s._scrollTop=s.$scrollArea.scrollTop()}function n(e,t){t._curY=e.touches[0].pageY;t._moveY=t._curY-t._startY;if(t._moveY>0){t.direction="down"}else if(t._moveY<0){t.direction="up"}var s=Math.abs(t._moveY);if(t.opts.loadUpFn!=""&&t._scrollTop<=0&&t.direction=="down"){e.preventDefault();if(!t.insertDOM){t.$element.prepend('<div class="'+t.opts.domUp.domClass+'"></div>');t.insertDOM=true}t.$domUp=o("."+t.opts.domUp.domClass);p(t.$domUp,0);if(s<=t.opts.distance){t._offsetY=s;t.$domUp.html("").append(t.opts.domUp.domRefresh)}else if(s>t.opts.distance&&s<=t.opts.distance*2){t._offsetY=t.opts.distance+(s-t.opts.distance)*.5;t.$domUp.html("").append(t.opts.domUp.domUpdate)}else{t._offsetY=t.opts.distance+t.opts.distance*.5+(s-t.opts.distance*2)*.2}t.$domUp.css({height:t._offsetY})}if(t.opts.loadDownFn!=""&&t._childrenHeight<=t._meHeight+t._scrollTop&&t.direction=="up"){e.preventDefault();if(!t.insertDOM){t.$element.append('<div class="'+t.opts.domDown.domClass+'"></div>');t.insertDOM=true}t.$domDown=o("."+t.opts.domDown.domClass);p(t.$domDown,0);if(s<=t.opts.distance){t._offsetY=s;t.$domDown.html("").append(t.opts.domDown.domRefresh)}else if(s>t.opts.distance&&s<=t.opts.distance*2){t._offsetY=t.opts.distance+(s-t.opts.distance)*.5;t.$domDown.html("").append(t.opts.domDown.domUpdate)}else{t._offsetY=t.opts.distance+t.opts.distance*.5+(s-t.opts.distance*2)*.2}t.$domDown.css({height:t._offsetY});t.$scrollArea.scrollTop(t._offsetY+t._scrollTop)}}function a(e){var t=Math.abs(e._moveY);if(e.insertDOM){if(e.direction=="down"){e.$domResult=e.$domUp;e.domLoad=e.opts.domUp.domLoad}else if(e.direction=="up"){e.$domResult=e.$domDown;e.domLoad=e.opts.domDown.domLoad}p(e.$domResult,300);if(t>e.opts.distance){e.$domResult.css({height:e.$domResult.children().height()});e.$domResult.html("").append(e.domLoad);l(e)}else{e.$domResult.css({height:"0"}).on("webkitTransitionEnd",function(){e.insertDOM=false;o(this).remove()})}e._moveY=0}}function l(o){o.loading=true;if(o.opts.loadUpFn!=""&&o.direction=="down"){o.opts.loadUpFn(o)}else if(o.opts.loadDownFn!=""&&o.direction=="up"){o.opts.loadDownFn(o)}}s.prototype.lock=function(){var o=this;o.isLock=true};s.prototype.unlock=function(){var o=this;o.isLock=false};s.prototype.resetload=function(){var e=this;if(!!e.$domResult){e.$domResult.css({height:"0"}).on("webkitTransitionEnd",function(){e.loading=false;e.insertDOM=false;o(this).remove()})}};function p(o,e){o.css({"-webkit-transition":"all "+e+"ms",transition:"all "+e+"ms"})}})(window.Zepto||window.jQuery);