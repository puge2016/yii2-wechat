$(function(){if(typeof YI==="undefined"){YI={}}YI.dialog=function(opts){var defaults={id:"dialogWrap",appendTo:"body",mask:true,opacity:"0.3",overlayBg:"#000",overlayZindex:9999,closeDom:"",html:"",initFn:null,initDomFn:null,animate:"",callBack:null};var opts=$.extend(defaults,opts);this.id=opts.id;this.appendTo=opts.appendTo;this.mask=opts.mask;this.opacity=opts.opacity;this.overlayBg=opts.overlayBg;this.overlayZindex=opts.overlayZindex;this.closeDom=opts.closeDom;this.html=opts.html;this.callBack=opts.callBack;this.initFn=opts.initFn;this.initDomFn=opts.initDomFn;this.animate=opts.animate;this.init()};YI.dialog.prototype={init:function(){if(this.initDomFn){this.initDomFn()}this.bulidDom()},bulidDom:function(){var _this=this;$("div.yi-dialog-mask,div.dialog-wrap").remove();if(this.mask){var $dialogMask=$('<div class="yi-dialog-mask" id="dialogMask"></div>');$dialogMask.css({height:"100%",width:"100%",background:this.overlayBg,opacity:this.opacity,"z-index":this.overlayZindex});$(this.appendTo).append($dialogMask);this.mask=$dialogMask;this.mask.on("click touchstart touchmove",function(){_this.close()})}var $dialogWrap=$('<div class="dialog-wrap animated fast '+this.animate+'" id="dialogWrap"><div class="dialog-content"></div></div>'),$dialogContent=$dialogWrap.children(".dialog-content");$dialogContent.html(this.html);$(this.appendTo).append($dialogWrap);$dialogWrap.css({height:$dialogContent.height(),"z-index":this.overlayZindex+1000,"margin-top":-$dialogContent.height()/2-50});this.content=$dialogWrap},show:function(){if(this.initFn){this.initFn.apply(this)}if(this.mask){this.mask.css("display","block")}this.content.css({visibility:"visible",display:"block"});if(this.callBack){this.callBack.apply(this)}},close:function(){var _this=this;this.content.remove();_this.mask.css({display:"none",opacity:"0",filter:"Alpha(Opacity=0)"});if(_this.mask){_this.mask.remove()}}};YI.evalData=function(a){if(typeof(a)=="object"){return a}else{var list=null;try{list=$.parseJSON(a)}catch(e){eval("list="+a)}return list}};YI.deepCopy=function(json){if(typeof json=="number"||typeof json=="string"||typeof json=="boolean"){return json}else{if(typeof json=="object"){if(json instanceof Array){var newArr=[],i,len=json.length;for(i=0;i<len;i++){newArr[i]=arguments.callee(json[i])}return newArr}else{var newObj={};for(var name in json){newObj[name]=arguments.callee(json[name])}return newObj}}}};YI.createSelect=function(opts){var html=[];if(opts.initFn){html=opts.initFn(html)}for(var i in opts.data){var row=opts.data[i];if(typeof opts.format=="function"){html.push('<option value="'+row[opts.valField]+'">'+opts.format(row)+"</option>")}else{html.push('<option value="'+row[opts.valField]+'">'+row[opts.format]+"</option>")}}opts.$obj.html(html.join("\n"));if(opts.doneFn){opts.doneFn(opts.$obj)}};YI.getAjaxInfo=function(opts){var defaults={async:true,method:"get",processData:true,erro:null,isLoading:true,verify:false,verifyOne:null,formObj:null,beforeSend:null,tip:true,weui:false,showLoadingText:"拼命加载中...",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:""};var isSubmit=true;var reSerialize=false;var opts=$.extend(defaults,opts);if(opts.verify){var formObj;if(opts.verifyOne){formObj=opts.verifyOne}else{reSerialize=true;formObj=opts.formObj.find("input[data-minlength],input[data-pattern],input[data-required],select[data-required]")}formObj.each(function(i,e){var tmp=$(e).val();var minlength=$(e).data("minlength");var title=$(e).data("title");var requiredMsg=$(e).data("requiredmsg")||$(e).attr("placeholder");var strReg=$(e).data("pattern");var required=$(e).data("required");if(required){if($(e).val()==""){isSubmit=false;YI.tip(requiredMsg);return false}}if(minlength){if(tmp.length<minlength){isSubmit=false;YI.tip(title+"至少填写"+minlength+"位");return false}}if(strReg&&required){var reg=new RegExp(strReg);if(!reg.test(tmp)){isSubmit=false;YI.tip(title);return false}}})}if(isSubmit){if(opts.beforeSend){opts.beforeSend()}$.ajax({accepts:"text/html",processData:opts.processData,contentType:opts.contentType,async:opts.async,cache:false,type:opts.method,beforeSend:function(){if(opts.weui){$.showLoading(opts.showLoadingText)}if(opts.isLoading&&!opts.weui){YI.loading()}},url:opts.url,data:opts.data,dataType:"text",timeout:10000,success:function(data,textStatus,R){if(opts.weui){$.hideLoading()}if(opts.isLoading&&!opts.weui){$("div.yi-dialog-mask,div.dialog-wrap").remove()}data=YI.evalData(data);if(data.errno=="0"){opts.fn(data)}else{if(opts.tip){if(opts.weui){$.alert(data.errmsg)}else{YI.alert({msg:data.errmsg})}}if(opts.erro){opts.erro(data)}}},complete:function(textStatus){if(textStatus.statusText=="timeout"){if(opts.weui){$.alert("链接超时")}else{YI.alert({msg:"链接超时"})}}if(textStatus.status==400||textStatus.status==404||textStatus.status==403||textStatus.status==500){if(opts.weui){$.alert("请求失败")}else{YI.alert({msg:"请求失败"})}}},error:function(data){if(opts.weui){$.alert("请求失败，请检查您的网络设置")}else{YI.alert({msg:"请求失败，请检查您的网络设置"})}}})}};YI.getLocation=function(fn,erroFn){if(this.testGeolocation()){navigator.geolocation.getCurrentPosition(function(h){var j=h.coords.latitude;var i=h.coords.longitude;YI.getAjaxInfo({url:"/m/main/seekCity.json?location="+j+","+i,fn:function(res){$.cookie("cityId",res.data.cityId,{path:"/"});$.cookie("cityName",res.data.cityName,{path:"/"});if(fn){fn(res)}},tip:false,isLoading:false,erro:function(msg){if(erroFn){var error={};error.code=0;error.PERMISSION_DENIED=1;erroFn(error,msg)}}})},function(error){var str="";switch(error.code){case error.TIMEOUT:str="连接超时";break;case error.PERMISSION_DENIED:str="您拒绝了使用位置共享服务，查询已取消";break;case error.POSITION_UNAVAILABLE:str="获取位置信息失败";break;default:str="Gps定位失败"}if(erroFn){erroFn(error,str)}},{timeout:5000})}else{YI.confirm({msg:"定位失败，请手动选择",yFn:function(){window.location.href="/web/m/wap/area/area.jsp"},nFn:function(){}})}};YI.getLocation.prototype={testGeolocation:function(){if(!!navigator.geolocation){return true}return false}};YI.alert=function(opts){var defaults={title:"",yText:"确认",msg:"",yFn:null,initFn:null,nFn:null};var opts=$.extend(defaults,opts);var title="";if(opts.title){title="<h3>"+opts.title+"</h3>"}var html='<div class="confirm">'+title+'<span style="padding:25px 10px;">'+opts.msg+'</span><div class="btns"><a href="javascript:void(0)" style="border-right:none;width:100%" data-type="yes">'+opts.yText+"</a></div></div>";new YI.dialog({html:html,initFn:opts.initFn,callBack:function(){var _this=this;this.content.find(".confirm .btns > a").on("click",function(e){var isClose=true;if($(this).data("type")=="yes"){if(opts.yFn){opts.yFn(_this)}}else{if(opts.nFn){opts.nFn(_this)}}_this.close()})}}).show()};YI.confirm=function(opts){var defaults={title:"",yText:"确认",nText:"取消",msg:"",yFn:null,nFn:null};var opts=$.extend(defaults,opts);var title="";if(opts.title){title="<h3>"+opts.title+"</h3>"}var html='<div class="confirm">'+title+'<span style="padding:25px 10px;">'+opts.msg+'</span><div class="btns"><a href="javascript:void(0)" data-type="no">'+opts.nText+'</a><a href="javascript:void(0)" data-type="yes">'+opts.yText+"</a></div></div>";new YI.dialog({html:html,callBack:function(){var _this=this;this.content.find(".confirm .btns > a").on("click",function(e){var isClose=true;if($(this).data("type")=="yes"){if(opts.yFn){opts.yFn(_this)}}else{if(opts.nFn){opts.nFn(_this)}}_this.close()})}}).show()};YI.loading=function(){var html='<div class="dialog-loading animated fast fadeIn"><img src="/statics/common/wechat/img/wxloading70.gif" />拼命加载中...</div>';new YI.dialog({html:html,mask:true,animate:null,initFn:function(){$("#dialogWrap").css("background","transparent")}}).show()};YI.tip=function(msg,time,fn){time=time||3000;var html='<div class="dialog-tip animated fast fadeIn">'+msg+"</div>";new YI.dialog({html:html,mask:true,animate:null,initFn:function(){$("#dialogWrap").css("background","transparent")},callBack:function(){var _this=this;if(time>0){var val=time;(function(){val-=1000;if(val>0){setTimeout(arguments.callee,1000)}else{if(val<=0){if(fn){fn()}_this.close()}}})()}else{if(fn){fn(_this)}}}}).show()};YI.getUrlParam=function(url){url=url||window.location.href;var objRequest=new Object();if(url.indexOf("?")!=-1){url=url.split("?")[1];var strArr=url.split("&");for(var i=0;i<strArr.length;i++){objRequest[strArr[i].split("=")[0]]=decodeURI((strArr[i].split("=")[1]))}}return objRequest};YI.dateModify=function(date,days,operator){var nd=new Date(date);nd=nd.valueOf();if(operator=="+"){nd=nd+days*24*60*60*1000}else{if(operator=="-"){nd=nd-days*24*60*60*1000}else{return false}}nd=new Date(nd);return nd};$("#goTop,a.gotop").on("click",function(){setTimeout(function(){window.scrollTo(0,0)},60)})});Date.prototype.format=function(c){var a={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(c)){c=c.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in a){var d=a[b];if(new RegExp("("+b+")").test(c)){c=c.replace(RegExp.$1,RegExp.$1.length==1?d:("00"+d).substr((""+d).length))}}return c};Date.prototype.getWeek=function(){var a=new Array("周天","周一","周二","周三","周四","周五","周六");return a[this.getDay()]};Date.prototype.DayNumOfMonth=function(){var a=new Date(this.getFullYear(),this.getMonth()+1,0);return a.getDate()};Date.prototype.diff=function(b){var c=((this.getTime()-b.getTime())/(60*60*1000)).toFixed(1);c=c.toString();var a=c.substr(0,c.indexOf("."));var d=c.substr(c.indexOf("."),c.length)*60;return[a,d]};