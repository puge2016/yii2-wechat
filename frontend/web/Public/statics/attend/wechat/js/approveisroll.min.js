$(function(){var d=$("#approveIscroll"),e=d.find(".tab-ul ul"),h=$("#approveText").children("input"),f=$("#scrollContent").find("ul"),g=$("#approveText").children("em"),h=$("#approveText").children("input"),c=true,b={status:"",page:1,isme:YI.getUrlParam()["isme"],keyword:""},a={init:function(){this.bindEvent()},firstPage:1,ajaxInfo:function(i){var j=this;YI.getAjaxInfo({url:"/attend/approve/list",data:b,isLoading:false,fn:function(n){var n=n.data,q=n.approveList,s=n.staffList,p=n.leaveList,o="";$.each(q,function(w,y){var z=p[y.approve_type_id]?p[y.approve_type_id]["title"]:"未知申请",v=y.id,t=(b.isme==1||b.status==-1)?("/attend/approve/view?applyid="+v):("/attend/approve/approve?applyid="+v);if(b.isme==0){var x="";if(y.process==ignoreStatus){x='<span style="color: #00aa00;float: none;padding-right: 0;display: inline-block;">（转批）</span>'}var u=s[y.staff_id].we_avatar?s[y.staff_id].we_avatar:(__ASSETS__+"images/picm.jpg"),A=y.repeat?"block":"";o+='<li class="has-img"><a href="'+t+'"><dl><dt><img src="'+u+'" /></dt><dd>'+s[y.staff_id].we_name+"提交的"+z+x+"</dd><dd>"+(y.status==0?status1:status2)+'<span class="'+A+'">抄送给我</span></dd><dd>'+y.create_time+"</dd></dl></a><ins></ins></li>"}else{o+='<li class="no-img"><a href="'+t+'"><dl><dt>'+z+"</dt><dd>"+y.create_time+"</dd></dl></a><ins></ins></li>"}});var r=null;if(!o&&!$.trim(f.html())){f.html('<li class="no-data">暂无数据</li>');r=f.find("li:last")}else{if(!o&&$.trim(f.html())&&$.trim(f.text())=="暂无数据"){f.html('<li class="no-data">暂无数据</li>');r=f.find("li:last")}else{if(i=="append"){r=f.find("li:last");f[i](o)}else{f[i](o)}}}if(myScrollPlug){if(b.page>1){var l=r.position().top,m=$("#wrapper").height(),k=$("#pullDown").height();setTimeout(function(){if(l-(m+k)>0){myScrollPlug.scrollTo(0,-(l-m+r.height()+k),null,true)}},50)}myScrollPlug.refresh()}}})},bindEvent:function(){g.on("click",function(){b.keyword=$.trim(h.val());f.html("");l.ajaxInfo("html")});isme=YI.getUrlParam()["isme"];var l=this,k=['<li class="cur" data-status="0"><span>待处理</span></li>','<li data-status="1,2,3,4"><span>已处理</span></li>'],i=['<li class="cur" data-status="0"><span>审批中</span></li>','<li data-status="1"><span>同意</span></li>','<li data-status="2"><span>驳回</span></li>'];$("[data-type='tab']").tab({callBack:function(p,m,n){b.status=$.trim($(m).data("status"));b.page=1;f.html("");if(c){if(b.isme==0){localStorage.setItem("approvet1",n)}else{localStorage.setItem("approvet2",n)}}l.ajaxInfo("html")}});var j=$("#approveUl li");if(b.isme==0&&YI.getUrlParam()["type"]==1){c=false;j.eq(1).trigger("click");c=true}else{if(localStorage.getItem("approvet1")||localStorage.getItem("approvet2")){if(b.isme==0){j.eq(localStorage.getItem("approvet1")).trigger("click")}else{j.eq(localStorage.getItem("approvet2")).trigger("click")}}else{b.status=$.trim(d.find("ul li").eq(0).data("status"));l.ajaxInfo("append")}}window.pullDownAction=function(){b.page=1;l.ajaxInfo("html")};window.pullUpAction=function(){b.page++;l.ajaxInfo("append")}}};window.isScrollInit();a.init()});