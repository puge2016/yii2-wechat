$(function(){$(".recordList li").on("click",function(){var h=$(this).find("a").html();$(".selectList").html(h);$(".recordList").addClass("mui-table-view-chevron")});$(".approveCancel").on("click",function(){$.confirm(isCancelText,function(){window.close();wx.closeWindow()},function(){})});var a=0;var e="";var e="";var f=$("#appDate1"),d=$("#appDate2");$(".approveSubmit").unbind("click").on("click",function(){var l=$("input[name=approveid]").val();var k=$(".reason").val();var n=$("input[name=copy]").val();var m=$("#appDate2").attr("data-val");var h=$("#appDate1").attr("data-val");var o=$("input[name=address]").val();var p=$("#serverids").val();o?o:"";if(type==3){var i="";$(".going-input").each(function(){var q="0";if($(this).prop("checked")==true){q="1"}i=i+q})}if(!f.val()){$.alert("请选择开始时间");return false}if(!d.val()){$.alert("请选择结束时间");return false}if(type==3&&i=="0000"){$.alert("请选择出行方式");return false}if(type==4&&o==""){$.alert("请填写外出地点");return false}if(k==""){$.alert("请填写说明");return false}if(l==""){$.alert("请选择审批人");return false}if((check_pic==1&&p=="")){$.alert(check_pic_message);return false}if(a==1){return false}a=1;var j={address:o,tripMode:i,type:type,approveId:l,reason:k,startTime:h,endTime:m,copyIds:n,type_id:type_id,ccIds:cc_staff_ids,picstrs:p,level:level};YI.getAjaxInfo({url:"/attend/approve/apply",data:j,method:"post",tip:false,weui:true,fn:function(q){function r(){e=q.data.id;location.href="/attend/approve/applyprocess?applyid="+e}$.toast("申请成功");setTimeout(function(){r()},2000)},erro:function(q){a=0;$.alert(q.errmsg)}})});$(".arrivie").on("click",function(){$(".arrivie").not(this).removeAttr("checked");$(this).attr("checked","checked")});$(".approviList").on("click",function(){$(".approveIdList").html('<span class="on_name">@'+$(this).find("a").html()+"</span>");$(".approveId").attr("approveid",$(this).attr("approveid"));$(this).parent("ul").css("display","none");return false});$(".showApprove").on("click",function(){if($(this).parents("#list").find(".approviList").length>0){var h=$(this).parents("#list").find(".approviList").parents(".list")}else{var h=$(this).parents("#list").find(".leaveType").parents(".list")}if(h.css("display")=="block"){h.css("display","none")}else{h.css("display","block")}});$(".approviList").on("click",function(h){$(".approveIdList").html('<span class="on_name">@'+$(this).html()+"</span>");$(".approveId").attr("approveid",$(this).attr("approveid"));$(this).parents(".list").css("display","none");evt=h?h:window.event;h.isPropagationStopped()});function g(){var i=(new Date()).getFullYear();var h={};h.date={preset:"date"};h.datetime={preset:"datetime"};h.time={preset:"time"};h["default"]={theme:"android-ics light",display:"modal",mode:"scroller",dateFormat:"yyyy-mm-dd",lang:"zh",showNow:true,nowText:"今天",startYear:i-24,endYear:i+50};$("#appDate1").mobiscroll($.extend(h.datetime,h["default"]));$("#appDate2").mobiscroll($.extend(h.datetime,h["default"]))}var f=$("#appDate1"),d=$("#appDate2"),c=$("#qjDiff");window.setDateCallback=function(){d.attr("data-min",f.attr("data-link"));window.mobiScrollInit();b()};window.setEndDateCallback=function(){f.attr("data-max",d.attr("data-link"));window.mobiScrollInit();b()};function b(){if(!type_id){return false}if(f.attr("data-val")&&d.attr("data-val")){$.ajax({type:"post",url:"/attend/approve/applycomputed",data:{type_id:type_id,start_time:f.attr("data-val"),end_time:d.attr("data-val")},dataType:"json",cache:false,success:function(i){c.find("span").html(i.data.data);c.css("display","block").unbind("click").on("click",function(){$(this).children("section").html(i.data.explain).toggle()})}});var h=$("#recordList");$.ajax({type:"post",url:"/attend/approve/applychecklog",data:{apply_id:"",start_time:f.attr("data-val"),end_time:d.attr("data-val")},dataType:"json",cache:false,success:function(k){var k=k.data.data,j=h.children("ul");if(k.length>0){var i="";$.each(k,function(l,m){i+="<li>"+m+"</li>"});j.html(i)}else{j.html("<li>无</li>")}h.show()}})}}});