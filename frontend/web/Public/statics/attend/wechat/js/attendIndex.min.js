(function(i){var l=navigator.userAgent.match(/MicroMessenger\/([\d\.]+)/i);if(l){var f=l[1].split(".");var h=m("bgyupdatewechat"+userId);if((h!=""&&h!=userId)||h==""){if(f[0]<6||(f[0]==6&&(f[1]<3||(f[1]==3&&(f[2]<7||f[2]==7))))){if(i.os.ios){YI.alert({msg:"为了提升用户体验，建议升级到微信最新版本"})}else{YI.confirm({msg:"为了提升用户体验，建议升级到微信最新版本",yText:"立即更新",nText:"暂不更新",yFn:function(){window.location.href="http://android.app.qq.com/myapp/detail.htm?apkName=com.tencent.mm"}})}p("bgyupdatewechat"+userId,userId,3)}}}function p(r,t,q){var s=new Date();s.setDate(s.getDate()+q);document.cookie=r+"="+encodeURIComponent(t)+";expires="+s.toGMTString()}function m(t){var q=document.cookie.split("; ");var u=0;for(u=0;u<q.length;u++){var s=q[u].split("=");if(s[0]==t){var r=decodeURIComponent(s[1]);return r}}return""}function d(q){p(q,"1",-1)}var j=i("#showBtn"),e=i(".checkStatus"),a=i("#freshBtn"),c=i("#indexUl"),b=i(".timer"),n=i("#openBtn"),g=i(".showCheck"),o=false,k={init:function(){i.each($deviceList,function(q,r){if(i.inArray(r.type,$deviceArr)!=-1){o=true;return false}});if(!o&&!$isOutWork){g.hide();g.parents(".t").css("height","55px")}this.setTime();this.bindEvent()},setTime:function(){function q(u,t){if(typeof t!=="number"){return}var w=new Date(u*1000);var r=w.getTime();var v=w.getTimezoneOffset()*60000;var s=r+v;return new Date(s+3600000*t)}serverTime=q(serverTime,8).getTime();new Vue({el:"#attendWrap",data:{time:""},ready:function(){var s=this;function r(){var w=new Date(serverTime),v=w.getHours(),t=w.getMinutes(),u=w.getSeconds();if(v<10){v="0"+v}if(t<10){t="0"+t}if(u<10){u="0"+u}s.time=v+":"+t+":"+u;serverTime+=1000}r();setInterval(r,1000)}})},bindEvent:function(){var r=this;setTimeout(function(){c.find("li a").children("em").addClass("animated rubberBand");setTimeout(function(){r.openBtnClick()},100)},250);var q=c.find("li i");i.each(q,function(t,u){var s=i(u).data("num");if(s>0&&s<100){i(u).html(s).show()}if(s>=100){i(u).html("···").show()}})},openBtnClick:function(){n.on("click",function(){var q=i(this).data("url");YI.loading();i.ajax({url:q,cache:false,method:"get",dataType:"json",success:function(r){if(r.errno=="0"){location.href=q;location.href="/attend/check/success?aid="+aid+"&userid="+userId+"&date="+serverDate}else{if(r.errno==390201){location.href=q}else{YI.alert({msg:r.errmsg||"Wifi打卡不在范围内"})}}}})})},beforeFun:function(){var s=$isGps=0;var w=true;i.each($deviceList,function(z,A){if(A.type==0){$isGps=1;w=false}else{if(A.type==1){s=1;w=false}}});if(w){e.html("管理员已关闭微信打卡")}if($isGps==1){x()}if(s==1){y()}var u=0;var t=0;function q(){i.ajax({type:"post",url:"/attend/check/ip",data:"",dataType:"json",success:function(z){if(z.errno==0){i(".check").hide()}YI.alert({msg:z.errmsg||"打卡成功"})}})}function y(){i.ajax({type:"get",url:"/attend/check/ip",data:"",dataType:"json",success:function(z){if(z.errno==0){u=1;t+=1;j.show();i(".checkStatus").html("您已在考勤范围内")}else{i(".checkStatus").html("您不在考勤范围内");j.hide()}a.show()}})}var v=lng=0;function x(){var z=new BMap.Geolocation();z.getCurrentPosition(function(A){if(this.getStatus()==BMAP_STATUS_SUCCESS){v=A.point.lat;lng=A.point.lng;i.ajax({type:"get",url:"/attend/check/gps?lat="+A.point.lat+"&lng="+A.point.lng,data:"",dataType:"json",success:function(B){if(B.errno==0){t+=10;u=1;j.show();i(".checkStatus").html("您已在考勤范围内")}else{if(u==0){i(".checkStatus").html("您不在考勤范围内")}j.hide()}a.show()}})}},{enableHighAccuracy:true,timeout:5000,maximumAge:60*1000})}function r(){if(v==0){return false}var z={lat:v,lng:lng};i.ajax({type:"post",url:"/attend/check/gps",data:z,dataType:"json",success:function(A){if(A.errno==0){i(".check").hide()}YI.alert({msg:A.errmsg||"打卡成功"})}})}i(".checkBtn").on("click",function(){if(t==1){q()}if(t==10){r()}if(t==11){r();q()}});i("#freshBtn").on("click",function(){y();x()})}};i(function(){k.init()})})(Zepto);