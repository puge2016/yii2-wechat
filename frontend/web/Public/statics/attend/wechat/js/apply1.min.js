(function(b){if(b(".leaveType").length==0&&type==1){b.alert("请联系管理员添加请假类型")}b(".recordList li").on("click",function(){var c=b(this).find("a").html();b(".selectList").html(c);b(".recordList").addClass("mui-table-view-chevron")});b(".approveCancel").on("click",function(){b.confirm(isCancelText,function(){window.close();wx.closeWindow()},function(){})});b(".approveSubmit").unbind("click").on("click",function(){leaveSubmit()});var a=b("#qjDetailText");b(".selectLeaveType").on("change",function(d){var c=b(".selectLeaveType option:selected").index();type_id=b(".selectLeaveType option").eq(c).attr("type_id");typeName=b(".selectLeaveType option").eq(c).html();check_pic=b(".selectLeaveType option").eq(c).attr("check_pic");check_pic_message=b(".selectLeaveType option").eq(c).attr("check_pic_message");var e=b(".selectLeaveType option").eq(c).attr("unit");if(e>=480){setDate("")}else{setDate("datetime")}var f=b.trim(b(this).val());b.each(b(this).children("option"),function(g,h){if(f==b.trim(b(h).attr("type_id"))){var j=b.trim(b(h).data("desc"));if(j){a.html(j).show();a.parent().show()}else{a.html("").hide();a.parent().hide()}return false}});b(".shuo").hide();leaveTypeInfo={type_id:type_id};isSend=1;b.ajax({type:"post",url:"/attend/approve/approvestafflist",data:leaveTypeInfo,dataType:"json",cache:false,success:function(j){allow_select=j.allow_select;cc_staff_ids=j.cc_staff_ids;var h=j.staff_list;var k="";for(var g=0;g<h.length;g++){if(k!=""){k+=","}k+=h[g].id}b(".approveStaff").attr("data-select",j.allow_select);b(".approveStaff").attr("data-ids",k);b(".copyStaff").attr("data-ids",j.cc_staff_ids);window.selectUserInit();if(j.day!=undefined){b(".shuo").find("span").eq(0).html(typeName);b(".shuo").find("span").eq(1).html(j.day);b(".shuo").find("span").eq(2).html(j.hour);b(".shuo_message").css("display","block")}else{b(".shuo_message").css("display","none")}}});b(this).parent("ul").css("display","none")});b(".mui-collapse a").on("click",function(){b(this).parent("li").find("ul").css("display","block")});b(".showApprove").on("click",function(){if(b(this).parents("#list").find(".approviList").length>0){var c=b(this).parents("#list").find(".approviList").parents(".list")}else{var c=b(this).parents("#list").find(".leaveType").parents(".list")}if(c.css("display")=="block"){c.css("display","none")}else{c.css("display","block")}});b(".approviList").live("click",function(c){b(".approveIdList").html('<span class="on_name">@'+b(this).html()+"</span>");b(".approveId").attr("approveid",b(this).attr("approveid"));b(this).parents(".list").css("display","none");evt=c?c:window.event;c.isPropagationStopped()});b(".dialogShow").on("click",function(){b.alert(message.content)})})(Zepto);function setDate(a){if(a==""){$("#appDate1,#appDate2").removeClass("datetime-select").addClass("date-select")}else{$("#appDate1,#appDate2").removeClass("date-select").addClass("datetime-select")}$("#appDate1,#appDate2").val("").data("val","");window.mobiScrollInit()}var $appDate1=$("#appDate1"),$appDate2=$("#appDate2"),$qjDiff=$("#qjDiff");window.setDateCallback=function(){$appDate2.attr("data-min",$appDate1.attr("data-link"));window.mobiScrollInit();renderDateDiff()};window.setEndDateCallback=function(){$appDate1.attr("data-max",$appDate2.attr("data-link"));window.mobiScrollInit();renderDateDiff()};function renderDateDiff(){if(!type_id){return false}if($appDate1.attr("data-val")&&$appDate2.attr("data-val")){$.ajax({type:"post",url:"/attend/approve/applycomputed",data:{type_id:type_id,start_time:$appDate1.attr("data-val"),end_time:$appDate2.attr("data-val")},dataType:"json",cache:false,success:function(b){$qjDiff.find("span").html(b.data.data);$qjDiff.css("display","block").unbind("click").on("click",function(){$(this).children("section").html(b.data.explain).toggle()})}});var a=$("#recordList");$.ajax({type:"post",url:"/attend/approve/applychecklog",data:{apply_id:"",start_time:$appDate1.attr("data-val"),end_time:$appDate2.attr("data-val")},dataType:"json",cache:false,success:function(d){var d=d.data.data,c=a.children("ul");if(d.length>0){var b="";$.each(d,function(f,g){b+="<li>"+g+"</li>"});c.html(b)}else{c.html("<li>无</li>")}a.show()}})}}var isSubmit=submit=0;var leaveTypeInfo="";function leaveCancel(){isSubmit=0}var $appDate1=$("#appDate1"),$appDate2=$("#appDate2"),$serverids=$("#serverids");function leaveSubmit(){var d=$("input[name=approveid]").val();var c=$(".reason").val();var f=$("input[name=copy]").val();var a=$appDate1.attr("data-val");var e=$appDate2.attr("data-val");var h=type_id;cc_staff_ids=$("input[name=copy]").val();var i=$serverids.val();var b={isSubmit:isSubmit,type:type,approveId:d,type_id:h,reason:c,startTime:a,endTime:e,copyIds:f,checkmodel:checkmodel,ccIds:cc_staff_ids,picstrs:i,level:level};if(type==1){var g=$.extend({},leaveTypeInfo,b)}else{var g=b}if(h==""){$.alert("请选择请假类型");return false}if(!$appDate1.val()){$.alert("请选择开始时间");return false}if(!$appDate2.val()){$.alert("请选择结束时间");return false}if(c==""){$.alert("请填写说明");return false}if(d==""){$.alert("请选择审批人");return false}if((check_pic==1&&i=="")){$.alert(check_pic_message);return false}if(submit==1){return false}submit=1;YI.getAjaxInfo({url:"/attend/approve/apply",data:g,method:"post",tip:false,weui:true,fn:function(j){isSubmit=0;function k(){location.href="/attend/approve/applyprocess?applyid="+j.data.id}$.toast("申请成功");setTimeout(function(){k()},2000)},erro:function(j){submit=0;$.alert(j.errmsg)}})};